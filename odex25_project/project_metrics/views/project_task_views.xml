<?xml version="1.0" encoding="utf-8"?>
<odoo>



    <!-- Project Tasks from inherit-->
    <record id="view_task_form_inherit" model="ir.ui.view">
        <field name="name">project.task.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2" />
        <field name="arch" type="xml">
            <div class="oe_button_box" position="inside">
                <button name="action_task_progress" type="object" class="oe_stat_button" icon="fa-dashboard" string="Progress%" >
                </button>
            </div>


            <xpath expr="//field[@name='user_id']" position="before">
                <field name="department_ids" invisible="1"/>
                <field name="plan_by_departments" invisible="1"/>
                <field name="department_id"  domain="[('id','in',department_ids)]" attrs="{'invisible': [('plan_by_departments', '=', False)]}"/>

            </xpath>

            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="weight" />
                <field name="plan_details_ids" widget="many2many_tags" invisible="1" />
            </xpath>
            <xpath expr="//page[@name='description_page']" position="after">
                <page name="progress_page" string="Progress">
                    <group name="progress">
                        <field name="task_progress_ids" nolabel="1" widget="x2many_2d_matrix" field_x_axis="week_id" field_y_axis="task_id" field_value="task_progress" show_column_totals="0">
                            <tree limit="1000000">
                                <field name="task_progress" />
                                <field name="task_id" />
                                <field name="week_id" />
                            </tree>
                        </field>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Project Task tree Inherit-->
    <record id="view_task_tree_inherit" model="ir.ui.view">
        <field name="name">project.task.tree</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project_base.view_task_tree" />
        <field name="arch" type="xml">

            <field name="phase_id" position="after">
                <field name="department_id"/>
            </field>
        </field>
    </record>




    <!-- Project Task search view Inherit-->
    <record id="view_task_search_form_inherit" model="ir.ui.view">
        <field name="name">project.task.filter</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project_base.view_task_search_form" />
        <field name="arch" type="xml">
            <field name="project_id" position="after">
                <field name="phase_id" />
            </field>
            <filter name="group_phase_id" position="after">
                <filter string="Department" name="group_department_id" icon="terp-folder-violet" domain="[]" context="{'group_by':'department_id'}" />
            </filter>

        </field>
    </record>

    <!-- Task pivot-->
    <record id="view_task_pivot" model="ir.ui.view">
        <field name="name">project.task.pivot</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_project_task_pivot" />
        <field name="arch" type="xml">
            <field name="project_id" position="after">
                <field name="effective_hours" type="measure"/>
                <field name="planned_hours" type="measure"/>
            </field>
            <field name="stage_id" position="replace">
                <field name="department_id" type="col"/>
            </field>
        </field>
    </record>






    <record id="project_task_progress_pivot_view" model="ir.ui.view">
        <field name="name">project.task.progress.pivot.view</field>
        <field name="model">project.task.progress</field>
        <field name="arch" type="xml">
            <pivot string="Activities Progress Report" sample="1">
                <field name="project_id" type="row" />
                <field name="department_id" type="row" />
                <field name="task_id" type="row" />
                <field name="week_id" type="col" />
                <field name="task_progress" type="measure" />
            </pivot>
        </field>
    </record>

    <record id="project_task_progress_tree_view" model="ir.ui.view">
        <field name="name">project.task.progress.tree.view</field>
        <field name="model">project.task.progress</field>
        <field name="arch" type="xml">
            <tree string="Activities Progress" sample="1" editable="top">
                <field name="week_id" readonly="1"/>
                <field name="task_progress"/>
            </tree>
        </field>
    </record>

    <record id="project_task_progress_pivot_action" model="ir.actions.act_window">
        <field name="name">Activities Progress Report</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.task.progress</field>
        <field name="view_mode">pivot</field>
        <field name="view_id" ref="project_task_progress_pivot_view" />
    </record>

    <!-- inherit action to remove default filter-->
    <!-- 'search_default_group_phase_id':1,'search_default_group_component_id':1 -->
    <record id="project.action_view_all_task" model="ir.actions.act_window">
        <field name="context">{'all_task':0,'search_default_project':1}</field>
    </record>


    <menuitem action="project_task_progress_pivot_action" id="activity_progress_report_menu" name="Activities Progress Report" parent="project.menu_project_report" sequence="150" />


</odoo>
